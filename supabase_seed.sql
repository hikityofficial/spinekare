-- 1. Create Exercises Table
CREATE TABLE public.exercises (
  id bigint GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  name text NOT NULL,
  description text NOT NULL,
  target_area text NOT NULL,
  category text NOT NULL,
  duration_seconds integer NOT NULL,
  reps text,
  what_it_does text,
  difficulty text NOT NULL
);

-- 2. Create Routines Table
CREATE TABLE public.routines (
  id bigint GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  day_number integer NOT NULL UNIQUE,
  title text NOT NULL,
  focus_area text NOT NULL,
  estimated_minutes integer NOT NULL
);

-- 3. Create Routine_Exercises Mapping Table
CREATE TABLE public.routine_exercises (
  id bigint GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  routine_id bigint REFERENCES public.routines(id) ON DELETE CASCADE,
  exercise_id bigint REFERENCES public.exercises(id) ON DELETE CASCADE,
  order_index integer NOT NULL
);

-- 4. Create Spine Facts Table
CREATE TABLE public.spine_facts (
  id bigint GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  day_number integer NOT NULL UNIQUE,
  fact text NOT NULL,
  category text NOT NULL
);

-- Set Security (Public Read Access)
ALTER TABLE public.exercises ENABLE ROW LEVEL SECURITY;
ALTER TABLE public.routines ENABLE ROW LEVEL SECURITY;
ALTER TABLE public.routine_exercises ENABLE ROW LEVEL SECURITY;
ALTER TABLE public.spine_facts ENABLE ROW LEVEL SECURITY;

CREATE POLICY "Enable read access for all users" ON public.exercises FOR SELECT USING (true);
CREATE POLICY "Enable read access for all users" ON public.routines FOR SELECT USING (true);
CREATE POLICY "Enable read access for all users" ON public.routine_exercises FOR SELECT USING (true);
CREATE POLICY "Enable read access for all users" ON public.spine_facts FOR SELECT USING (true);

-- Insert Core Exercises
INSERT INTO public.exercises (id, name, description, target_area, category, duration_seconds, what_it_does, difficulty) VALUES
(1, 'Cat-Cow Stretch', 'A gentle flow between two animal poses that warms the body and brings flexibility to the spine.', 'full', 'Flexibility', 60, 'Improves lumbar flexibility and relieves disc compression', 'beginner'),
(2, 'Child''s Pose', 'A resting posture that stretches the back muscles and decompresses the spine.', 'lumbar', 'Decompression', 45, 'Gently stretches the lower back and hips, relieving tension', 'beginner'),
(3, 'Bird Dog', 'A floor exercise that strengthens the core while moving the limbs.', 'core', 'Strengthening', 60, 'Builds core stability to protect the lower spine', 'intermediate'),
(4, 'Thoracic Rotation', 'Opening up the mid-back to prevent stiffness from sitting.', 'thoracic', 'Mobility', 45, 'Prevents upper back rounding and improves breathing mechanics', 'beginner'),
(5, 'Cervical Retraction (Chin Tucks)', 'Pulling the head straight back to align the neck.', 'cervical', 'Posture correction', 30, 'Counteracts "text neck" and forward head posture', 'beginner'),
(6, 'Prone Cobra', 'Lying on the stomach and lifting the chest slightly.', 'lumbar', 'Strengthening', 45, 'Strengthens the erector spinae muscles along the spine', 'intermediate');

-- Insert Initial Routines (Days 1-3)
INSERT INTO public.routines (id, day_number, title, focus_area, estimated_minutes) VALUES
(1, 1, 'Day 1 — Full Spine Mobility', 'Full Spine Mobility', 5),
(2, 2, 'Day 2 — Lumbar Relief', 'Lumbar Relief', 4),
(3, 3, 'Day 3 — Core Stability', 'Core Stability', 5);

-- Map Exercises to Routines
INSERT INTO public.routine_exercises (routine_id, exercise_id, order_index) VALUES
(1, 1, 1), (1, 4, 2), (1, 2, 3), (1, 5, 4),
(2, 2, 1), (2, 6, 2), (2, 3, 3),
(3, 3, 1), (3, 6, 2), (3, 1, 3), (3, 4, 4);

-- Insert Spine Facts (Days 1-5)
INSERT INTO public.spine_facts (id, day_number, fact, category) VALUES
(1, 1, 'The intervertebral discs in your spine act as shock absorbers and are 80% water when you wake up.', 'Anatomy'),
(2, 2, 'Your spine has natural curves — the S-shape is a biomechanical marvel that distributes load across your body.', 'Anatomy'),
(3, 3, 'Humans lose about 1cm of height throughout the day as spinal discs compress under gravity.', 'Anatomy'),
(4, 4, 'Sitting puts up to 40% more pressure on your spine than standing.', 'Biomechanics'),
(5, 5, 'A strong core acts like a muscular corset, taking up to 30% of the load off your lower back.', 'Biomechanics');
